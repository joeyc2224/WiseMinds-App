<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/tokens.css">

    <script src="https://unpkg.com/@api.video/media-recorder" defer></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Post</title>
</head>

<body>

    <div class="sidenav">
        <img src="images/WiseMinds(1).svg"
            style="width: 110%; margin-bottom: -60px; margin-top: -60px; margin-left: -10px;">
        <a href="index.html"><i class="fa fa-fw fa-home"></i>Home</a>
        <a href=""><i class="fa fa-fw fa-feed"></i>Stories</a>
        <a href=""><i class="fa fa-fw fa-user"></i>Profile</a>
        <a class="active" href="post.html"><i class="fa fa-fw fa-paper-plane"></i>Post</a>
    </div>


    <div class="main">
        <h2>New Post</h2>
        <div>
            <form action="/newpost" method="POST">
                <label>Caption:</label>
                <input type="text" id="message" name="message"><br>
                <br>
                <input type="submit" value="Post">
            </form>
        </div>

        <br><br>

        <div id="container">
            <div>
                <video id="video"></video>
            </div>
            <div>
                <button id="start" disabled>start recording</button>
                <button id="stop" disabled>stop recording</button>
            </div>
            <div>
                <p>Video link: <span id="video-link"><i>will be displayed when the recording is
                            finished</i></span></p>
            </div>
        </div>


        <script>
            const video = document.querySelector('#video');
            const startButton = document.getElementById("start");
            const stopButton = document.getElementById("stop");
            const videoLink = document.getElementById("video-link");
            let stream, recorder;

            var constraints = window.constraints = {
                audio: true,
                video: true
            };

            navigator.mediaDevices.getUserMedia(constraints).then((s) => {
                stream = s;
                video.srcObject = s;
                video.play();
                startButton.disabled = false;
            });

            document.getElementById("start").addEventListener("click", () => {
                recorder = new ApiVideoMediaRecorder(stream, {
                    uploadToken: "to28AX3NCqTXkrMOieyDlViA"
                });

                recorder.start();

                startButton.disabled = true;
                stopButton.disabled = false;
            });

            document.getElementById("stop").addEventListener("click", () => {
                startButton.disabled = false;
                stopButton.disabled = true;

                recorder.stop().then(v => videoLink.innerHTML = v.assets.player);
            });

        </script>

    </div>

</body>

</html>